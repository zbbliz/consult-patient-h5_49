# 优医问诊项目

### 登录存储token用户信息

使用 pinia 管理数据 和 pinia-plugin-persistedstate **实现数据持久化**

```typescript
// 引入然后挂载到 pinia 上 // vue使用pinia插件， use(pinia的插件)
import persist from 'pinia-plugin-persistedstate'
app.use(createPinia().use(persist))
```

在用户仓库第三个参数中配置

```typescript
  {
    persist: true // 默认是存入 localStorage中
  }
```

###移动端适配

**使用 postcss-px-to-viewport 包**

```js
// eslint-disable-next-line no-undef 配置文件 postcss.config.js
module.exports = {
  plugins: {
    'postcss-px-to-viewport': {
      // 设备宽度375计算vw的值
      viewportWidth: 375,
    },
  },
};
```
###axios二次封装

1.  创建新的 axios 实例，配置基地址
2.  请求拦截器，请求头携带 token
3.  响应拦截器，判断token是否过期401，如果过期了（删除之前的user数据）则跳转到 登录页 登录之后跳转回之前的页面

```typescript
// path 路径 /user 不带查询参数
// fullPath 完整路径 /user?id=2000 包括 path、 query 和 hash
router.push(`/login?returnUrl=?${router.currentRoute.value.fullPath}`) // 路由实例拿到当前路由信息
```

**封装请求函数**

-  参数：url method submitData
- 返回: instance 调用接口的 promise 对象

泛型约束返回数据的类型

```typescript
type Data<T> = {
  code: string
  message: string
  data: T
}
const request = <T>(
  url: string,
  method: Method = 'GET', // 默认GET类型
  submitData?: object
) => {
  // 泛型的第二个参数，可以自定义响应式数据类型
  // 只传一个参数，用的是axios默认的格式，传入第二个参数返回数据就是第二个参数的格式
  return instance.request<T, Data<T>>({
    url,
    method,
    // toLowerCase 把传入的请求类型都改为小写，因为可能传入GET
    // [] 里面可以写变量 还有表达式
    [method.toLowerCase() === 'get' ? 'params' : 'data']: submitData // 区分 GET 请求和其他请求
  })
}
```

### typeof

从一个 js 对象中得到它对应的类型

```typescript
const obj = {
  name: 'jack',
  age: 22
}
type Obj = typeof obj
const obj2: Obj = {
  name: 'tom',
  age: 24
}
```

