# 优医问诊项目

### 登录存储token用户信息

使用 pinia 管理数据 和 pinia-plugin-persistedstate **实现数据持久化**

```typescript
// 引入然后挂载到 pinia 上 // vue使用pinia插件， use(pinia的插件)
import persist from 'pinia-plugin-persistedstate'
app.use(createPinia().use(persist))
```

在用户仓库第三个参数中配置

```typescript
  {
    persist: true // 默认是存入 localStorage中
  }
```

###移动端适配

**使用 postcss-px-to-viewport 包**

```js
// eslint-disable-next-line no-undef 配置文件 postcss.config.js
module.exports = {
  plugins: {
    'postcss-px-to-viewport': {
      // 设备宽度375计算vw的值
      viewportWidth: 375,
    },
  },
};
```
###axios二次封装

1.  创建新的 axios 实例，配置基地址
2.  请求拦截器，请求头携带 token
3.  响应拦截器，判断token是否过期401，如果过期了（删除之前的user数据）则跳转到 登录页 登录之后跳转回之前的页面

```typescript
// path 路径 /user 不带查询参数
// fullPath 完整路径 /user?id=2000 包括 path、 query 和 hash
router.push(`/login?returnUrl=?${router.currentRoute.value.fullPath}`) // 路由实例拿到当前路由信息
```

**封装请求函数**

-  参数：url method submitData
- 返回: instance 调用接口的 promise 对象

泛型约束返回数据的类型

```typescript
type Data<T> = {
  code: string
  message: string
  data: T
}
const request = <T>(
  url: string,
  method: Method = 'GET', // 默认GET类型
  submitData?: object
) => {
  // 泛型的第二个参数，可以自定义响应式数据类型
  // 只传一个参数，用的是axios默认的格式，传入第二个参数返回数据就是第二个参数的格式
  return instance.request<T, Data<T>>({
    url,
    method,
    // toLowerCase 把传入的请求类型都改为小写，因为可能传入GET
    // [] 里面可以写变量 还有表达式
    [method.toLowerCase() === 'get' ? 'params' : 'data']: submitData // 区分 GET 请求和其他请求
  })
}
```

### typeof

从一个 js 对象中得到它对应的类型

```typescript
const obj = {
  name: 'jack',
  age: 22
}
type Obj = typeof obj
const obj2: Obj = {
  name: 'tom',
  age: 24
}
```

### 登录页面构建

**账号登录和短信验证码切换登录**

### 页面布局

封装头部navbar组件 和 icon组件

路由挂载配置路由：一级路由布局页面layout 二级路由 { home ，article， notify，user }

### 访问权限控制

通过路由守卫

**当没有token且访问的不是白名单内，直接return返回到登录页**

```typescript
//vue3写法
router.beforeEach((to) => {
  // 如果 return true 或者什么也不写 就是放行
  // 拦截到某个页面 return '路由地址'
  const store = useUserStore()
  const whiteList = ['/login']
  // 需求：当没有token时 且 访问的不是白名单里面的路由地址 直接跳到登录页面
  if (!store.user?.token && !whiteList.includes(to.path)) return '/login'
  // 否则不做任何处理
})
```

### Pick 与 Omit TS内置类型

Pick 可以从一个对象类型中 取某些属性

```typescript
type Person = {
    name: string
    age: number
}
//泛型传入第一个参数是类型别名，第二个是想要获取的属性
type PickPerson = Pick<Person, 'name'> 
// PickPerson === { name: string }
```

Omit 可以从一个对象类型中 排除指定属性得到剩余的

```typescript
type Person = {
    name: sting
    age: number
    hobby: string
}
type OmitPerson = Omit<Person, 'age'>
// OmitPerson === { name: string, hobby: string }
```

### 家庭档案 v-model 语法糖

```html
 	vue3的 v-model 语法糖
<com-a :modelValue="count" @update:modelValue="count += $event"></com-a>
<com-a v-model="count" :car="car" @update:car="car = $event"></com-a>
<com-a v-model:count="count" v-model:car="car"></com-a>
	子组件
defineProps<{
  count: number
  car: string
}>()
const emit = defineEmits<{
  (e: 'update:count', count: number): void
  (e: 'update:car', car: string): void
}>()
```

### Vue-Router API v4.x 组件API

**onBeforeRouteLeave** 添加一个导航守卫在当前位置的组件将要离开的时候触发

```typescript
onBeforeRouteLeave(() => {
  // 离开路由时触发 然会false就走不了
  if (orderId.value) return false
})
```

## 问诊室

### 结构

####头部组件

（三个阶段：未回复 / 咨询中 / 已结束 ）

####主体聊天部分

分为：

**病情描述卡片**

**提示信息**

**发送信息和图片**

**接受信息和图片**

#### 底部组件



